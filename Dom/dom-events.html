<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>Document</title>
    <style>
        #move-ball-field {
            width: 200px;
            height: 150px;
            border: 10px solid black;
            background-color: #00FF00;
            overflow: hidden;
            position: relative;
        }

        #move-ball {
            position: absolute;
            transition: all 0.5s ease-in-out;
            left: 0;
            top: 0;
        }

        #title::before {
            content: '▶ ';
            font-size: 80%;
            color: green;
        }

        #title.open::before {
            content: '▼ ';
        }

        .pane {
            background: #edf5e1;
            padding: 10px 20px 10px;
            border-top: solid 2px #c4df9b;
            position: relative;
        }

        .remove-button {
            position: absolute;
            font-size: 110%;
            top: 0;
            color: darkred;
            right: 10px;
            display: block;
            width: 24px;
            height: 24px;
            border: none;
            background: transparent;
            cursor: pointer;
        }

        .tooltip {
            position: fixed;
            padding: 10px 20px;
            border: 1px solid #b3c9ce;
            border-radius: 4px;
            text-align: center;
            font: italic 14px/1.3 sans-serif;
            color: #333;
            background: #fff;
            box-shadow: 3px 3px 3px rgba(0, 0, 0, .3);
        }

        #house {
            margin-top: 50px;
            width: 400px;
            border: 1px solid brown;
        }

        #roof {
            width: 0;
            height: 0;
            border-left: 200px solid transparent;
            border-right: 200px solid transparent;
            border-bottom: 20px solid brown;
            margin-top: -20px;
        }

        .slider {
            border-radius: 5px;
            background: #E0E0E0;
            background: linear-gradient(left top, #E0E0E0, #EEEEEE);
            width: 310px;
            height: 15px;
            margin: 5px;
        }

        .thumb {
            width: 10px;
            height: 25px;
            border-radius: 3px;
            position: relative;
            left: 10px;
            top: -5px;
            background: blue;
            cursor: pointer;
        }
    </style>
</head>
<body style="height:2000px">
Hide button after click on it
<div id="hide-button">
    <input id="hider" type="button" value="Click to hide me"/>
</div>
<hr/>
Move ball to mouse click
<div id="move-ball-container">
    <div id="move-ball-field">
        <img height="40" id="move-ball" src="https://ru.js.cx/clipart/ball.svg" width="40"> . . . . . . . . . . . . . .
        . . . . . .
        . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .
        . . . . . . . . . . . . . . . . . . . . . .
    </div>
</div>

<hr/>

<div id="open-list">
    <div id="title">Сладости (нажми меня)!</div>
    <ul>
        <li>Пирожное</li>
        <li>Пончик</li>
        <li>Мёд</li>
    </ul>
</div>

<hr/>
Event delegation: hide massages by button click
<div id="delegation">
    <div class="pane">
        <h3>Horse</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Asperiores commodi debitis esse fuga hic, iure
            laboriosam maiores molestias placeat quibusdam repudiandae, temporibus totam, velit veritatis voluptatibus.
            Illum modi optio repudiandae!</p>
        <button class="remove-button">[x]</button>
    </div>
    <div class="pane">
        <h3>Dog</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Culpa odit placeat tenetur. A aliquam, atque dicta,
            eaque eos est fuga hic illum ipsum mollitia, nesciunt nostrum perferendis porro quae vitae.</p>
        <button class="remove-button">[x]</button>
    </div>
    <div class="pane">
        <h3>Cat</h3>
        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Amet animi aperiam autem cumque earum, hic incidunt
            ipsa nisi, rem rerum tempora vero vitae voluptatem. Debitis odio sed tempora? Ea, sit!
        </p>
        <button class="remove-button">[x]</button>
    </div>
</div>
<hr/>
<div id="delegation-tooltip">
    <p>Event delegation: tooltip</p>
    <button data-tooltip="Tooltip that is longer when button">Button</button>
    <button data-tooltip="HTML<br>tooltip">Another button</button>
</div>
<hr/>
<p>Event delegation + mouse events: improved tooltip</p>
<div data-tooltip="There's a house interior" id="house">
    <div data-tooltip="There's a roof" id="roof"></div>

    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Ab aspernatur minus necessitatibus numquam. Adipisci
        aliquid assumenda delectus voluptatem? Culpa eius error excepturi facere inventore, magnam nisi obcaecati
        officia saepe unde.</p>

    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Delectus iusto libero necessitatibus quidem sint, ullam
        voluptate?</p>

    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Accusantium aspernatur atque debitis earum, eligendi
        eveniet expedita in ipsum magnam minus perspiciatis porro, possimus qui quod similique? Ea expedita nemo
        perferendis!</p>

    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit <a
            data-tooltip="Read more..."
            href="https://ru.wikipedia.org/wiki/%D0%A2%D1%80%D0%B8_%D0%BF%D0%BE%D1%80%D0%BE%D1%81%D1%91%D0%BD%D0%BA%D0%B0">Put your cursor over me</a></p>

</div>

<hr/>
Make slider - drog and drop
<div id="slider" class="slider">
    <div class="thumb"></div>
</div>
<script>
  //Hide button after click on it
  const hideButton = document.getElementById('hide-button');
  hideButton.addEventListener('click', function () {
    this.style.display = 'none';
  });

  function getCoords(elem) {
    const box = elem.getBoundingClientRect();
    return {
      top: box.top + window.scrollY,
      right: box.right + window.scrollX,
      bottom: box.bottom + window.scrollY,
      left: box.left + window.scrollX
    }
  }

  //move ball to mouse click
  function moveBall() {

    document.getElementById('move-ball-field').addEventListener('click', function (event) {
      const moveBallField = document.getElementById('move-ball-field');
      const moveBall = document.getElementById('move-ball');

      // const ballWidth = moveBall.offsetWidth;
      // const ballHeight = moveBall.offsetHeight;
      //
      // const fieldCoords = moveBallField.getBoundingClientRect();
      //
      //
      // if (event.clientX - ballWidth / 2 < fieldCoords.left) {
      //   moveBall.style.left = 0;
      // } else if ( event.clientX + ballWidth / 2 > fieldCoords.right) {
      //   moveBall.style.left = moveBallField.clientWidth - ballWidth + 'px'
      // } else {
      //   moveBall.style.left = event.clientX - fieldCoords.left - ballWidth / 2 - moveBallField.clientLeft + 'px';
      // }
      //
      // if ( event.clientY - ballHeight / 2 < fieldCoords.top) {
      //   moveBall.style.top = 0 + 'px';
      // } else if (event.clientY + ballHeight / 2 > fieldCoords.bottom) {
      //   moveBall.style.top = moveBallField.clientHeight - ballHeight + 'px';
      // } else {
      //   moveBall.style.top = event.clientY - fieldCoords.top - ballHeight / 2 - moveBallField.clientTop  + 'px';
      // }

      // координаты поля относительно окна браузера
      let fieldCoords = this.getBoundingClientRect();

      // мяч имеет абсолютное позиционирование (position:absolute), поле - относительное (position:relative)
      // таким образом, координаты мяча рассчитываются относительно внутреннего, верхнего левого угла поля
      let ballCoords = {
        top: event.clientY - fieldCoords.top - moveBallField.clientTop - moveBall.clientHeight / 2,
        left: event.clientX - fieldCoords.left - moveBallField.clientLeft - moveBall.clientWidth / 2
      };

      // запрещаем пересекать верхнюю границу поля
      if (ballCoords.top < 0) ballCoords.top = 0;

      // запрещаем пересекать левую границу поля
      if (ballCoords.left < 0) ballCoords.left = 0;


      // // запрещаем пересекать правую границу поля
      if (ballCoords.left + moveBall.clientWidth > moveBallField.clientWidth) {
        ballCoords.left = moveBallField.clientWidth - moveBall.clientWidth;
      }

      // запрещаем пересекать нижнюю границу поля
      if (ballCoords.top + moveBall.clientHeight > moveBallField.clientHeight) {
        ballCoords.top = moveBallField.clientHeight - moveBall.clientHeight;
      }

      moveBall.style.left = ballCoords.left + 'px';
      moveBall.style.top = ballCoords.top + 'px';

    });
  }

  moveBall();

  //open list
  function openList() {
    const list = document.getElementById('open-list').querySelector('ul');
    const title = document.getElementById('title');

    title.addEventListener('click', function () {
      list.hidden = !list.hidden;
      title.classList.toggle('open');
    })
  }

  openList();

  //delegation: hide massage
  function hideMassage() {
    const delegation = document.getElementById('delegation');
    delegation.addEventListener('click', function (event) {
      if (event.target.classList.contains('remove-button')) {
        event.target.closest('.pane').remove();
      }
    })
  }

  hideMassage();

  //delegation - tooltip

  function removeTooltip(containerId) {
    const container = document.getElementById(containerId);
    const prevTooltip = container.querySelector('.tooltip');
    if (prevTooltip) {
      prevTooltip.remove()
    }
  }

  function createTooltip(containerId, tooltip, target) {
    const container = document.getElementById(containerId);
    const coords = target.getBoundingClientRect();

    const div = document.createElement('div');
    div.className = 'tooltip';
    div.innerHTML = tooltip;
    container.append(div);

    const top = (coords.top - 5 - div.offsetHeight < 0) ? coords.bottom + 5 : coords.top - 5 - div.offsetHeight;
    let left = (coords.left + coords.width / 2) - div.offsetWidth / 2;
    left = left < 0 ? 5 : left;
    div.style.top = top + 'px';
    div.style.left = left + 'px';
  }

  function delegationTooltip() {
    const container = document.getElementById('delegation-tooltip');

    function mouseHandler(event) {
      const tooltip = event.target.dataset.tooltip;
      if (!tooltip) return;

      if (event.type === 'mouseout') {
        removeTooltip('delegation-tooltip');
      }

      if (event.type === 'mouseover') {
        createTooltip('delegation-tooltip', tooltip, event.target);
        // const coords = event.target.getBoundingClientRect();
        //
        // const div = document.createElement('div');
        // div.className = 'tooltip';
        // div.innerHTML = tooltip;
        // container.append(div);
        //
        // const top = (coords.top - 5 - div.offsetHeight < 0 ) ? coords.bottom + 5 : coords.top - 5 - div.offsetHeight;
        // let left = (coords.left+coords.width/2) - div.offsetWidth/2;
        // left = left < 0 ? 5 : left;
        // div.style.top = top + 'px';
        // div.style.left = left + 'px';
      }
    }

    container.addEventListener('mouseover', mouseHandler);
    container.addEventListener('mouseout', mouseHandler);
  }

  delegationTooltip()

  //mouse move + delegation
  function improvedTooltip() {
    const container = document.getElementById('house');

    let currentElem = null;

    function mouseOverHandler(event) {
      const tooltipElem = event.target.closest('[data-tooltip]');
      if (!tooltipElem || !container.contains(tooltipElem)) return;
      if (currentElem === tooltipElem) return;
      removeTooltip('house')
      createTooltip('house', tooltipElem.dataset.tooltip, tooltipElem);
      currentElem = tooltipElem;
    }

    function mouseOutHandler(event) {
      if (!currentElem) return
      if (!currentElem.contains(event.relatedTarget)) {
        removeTooltip('house')
        currentElem = null;
      }
    }

    container.addEventListener('mouseover', mouseOverHandler);
    container.addEventListener('mouseout', mouseOutHandler);
  }

  improvedTooltip();

  //slider - drag and drop

  function slide(){
    const slider = document.getElementById('slider');
    const thumb = slider.querySelector('.thumb');

    thumb.onmousedown = function (event) {
      let shiftX = event.clientX - thumb.getBoundingClientRect().left;

      const borders = slider.getBoundingClientRect();

      thumb.style.position = 'absolute';
      thumb.style.zIndex = 1000;
      document.body.append(thumb) // перемещение по документу

      moveAt(event.pageX, event.pageY);

      function moveAt(pageX, pageY = null) {
        if(pageY){
          thumb.style.top = pageY - shiftY + 'px';
        }
        let x = pageX - shiftX < borders.left ? borders.left : ( pageX - shiftX + thumb.offsetWidth > borders.right - thumb.offsetWidth ? borders.right - thumb.offsetWidth : pageX - shiftX );
        thumb.style.left = x + 'px';
      }

      function mouseMoveHandler(event) {
        moveAt(event.pageX);
      }

      function mouseUpHandler(){
        document.removeEventListener('mousemove', mouseMoveHandler);
        document.removeEventListener('mouseup', mouseUpHandler);
      }

      document.addEventListener('mousemove', mouseMoveHandler);
      document.addEventListener('mouseup', mouseUpHandler);

    };

    thumb.ondragstart = function (){
      return false
    };

  }
  slide();

  //keyboard events
  function runOnKeys(func){
    if(arguments.length < 2) return;
    const pressed = new Set();

    document.addEventListener('keydown', function(event){
      pressed.add(event.code);
    })

    document.addEventListener('keyup', (event) =>{
      if(pressed.size === arguments.length-1){
        let res = true;
        for(let i=1; i < arguments.length-1; i++){
          if (!pressed.has(arguments[i])){
            res = false;
          }
        }
        res && func();
      };
      pressed.delete(event.code);
    })
  }

  runOnKeys(
    () => alert("Привет!"),
    "KeyQ",
    "KeyW"
  );

  runOnKeys()

  //infiniteScrollPage
  function infiniteScroll(){
    window.addEventListener('scroll', function(event) {
      console.log(event)
      if (window.innerHeight + window.scrollY >= document.body.offsetHeight){
        document.body.insertAdjacentHTML("beforeend", `<p>Date: ${new Date()}</p>`);
      }

    });

  }

  infiniteScroll()

</script>
</body>
</html>